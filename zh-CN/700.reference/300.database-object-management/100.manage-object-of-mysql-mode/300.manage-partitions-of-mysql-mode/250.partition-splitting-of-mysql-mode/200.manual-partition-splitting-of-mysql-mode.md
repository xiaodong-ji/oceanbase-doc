|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|

# 手动分区分裂

OceanBase 数据库支持在分区表中手动进行分区分裂操作，即将一个已有的分区拆分为多个分区。这个功能可以指定需要分裂的分区和新分区的分裂位点进行手动执行分区分裂命令，根据需求和数据增长情况对分区进行调整。

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>当前版本分区分裂功能为实验特性，暂不建议在生产环境使用。</p>
</main>

## 手动分区分裂操作的支持情况

当前版本仅支持对 Range/Range Columns 分区的一级分区表进行手动分区分裂操作。

## 使用限制及注意事项

* 不支持手动分裂 Interval、List、Hash 分区表。
* 不支持手动分裂二级分区表。
* 不支持被手动分裂的表的分区键与主键前缀不一样。
* 不支持无主键表的手动分区分裂。
* 不支持列存表的手动分区分裂。
* 如果表所在的 `TABLEGROUP`（表组）里面包含了多张表时，不支持手动分区分裂；如果这个 `TABLEGROUP` 中只有这张表，则支持手动分区分裂。
* 不支持物化视图的手动分区分裂。
* 不支持全局索引的手动分裂。
* 不支持 GIS 索引的手动分裂。
* 不支持向量索引的手动分区分裂。
* 禁止单独分裂局部索引、LOB 表的分区。

## 手动分区分裂语法

```sql
ALTER TABLE table_name REORGANIZE PARTITION partition_name INTO (
        PARTITION split_partition_name VALUES LESS THAN (value)
        [, PARTITION split_partition_name VALUES LESS THAN (value) ...]
         , PARTITION split_partition_name VALUES LESS THAN (source_value));
```

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>在 OceanBase 数据库 MySQL 模式中，当前版本只支持一个分区分裂成多个分区，不支持多个分区分裂成多个分区。</p>
</main>

### 参数解释

|       **参数**       | **说明** |
|----------------------|----------|
| table_name           | 指定表名。|
| partition_name       | 指定待分裂的分区名称。|
| split_partition_name | 指定分裂出的新分区名称。|
| value                | 指定分区分裂的界限（取值范围）。<main id="notice" type='notice'><h4>注意</h4><p>手动分裂 Range 分区时，必须保证分区 <code>value</code> 的定义按升序排列，并且范围必须与原分区相同。</p></main>|
| source_value         | 指定待分裂分区原始界限（取值范围）。即最后一个分区分裂的定义，其 `value` 等同于原分区的 `value`。|

## 示例

创建 Range 分区的一级分区表 `test_tbl1`。

```sql
CREATE TABLE test_tbl1(col1 INT, col2 INT, PRIMARY KEY(col1))
    PARTITION BY RANGE(col1)
    (PARTITION p0 VALUES LESS THAN(100),
     PARTITION p1 VALUES LESS THAN(200),
     PARTITION p2 VALUES LESS THAN(300),
     PARTITION p_max VALUES LESS THAN (MAXVALUE));
```

* 把 `test_tbl1` 表的分区 `p0` 分裂成三个新的分区，分裂的位置是在 `30` 和 `60` 这两个值所对应的行上。分裂后，原来的分区 `p0` 被分成三个新的分区 `p0_1`、`p0_2` 和 `p0`。

    ```sql
    ALTER TABLE test_tbl1
        REORGANIZE PARTITION p0 INTO (
            PARTITION p0_1 VALUES LESS THAN (30),
            PARTITION p0_2 VALUES LESS THAN (60),
            PARTITION p0 VALUES LESS THAN (100));
    ```

* 把 `test_tbl1` 表的分区 `p_max` 分裂成三个新的分区，分裂的位置是在 `400` 和 `500` 这两个值所对应的行上。分裂后，原来的分区 `p_max` 被分成三个新的分区 `p_max_1`、`p_max_2` 和 `p_max_3`。

    ```sql
    ALTER TABLE test_tbl1
        REORGANIZE PARTITION p_max INTO (
            PARTITION p_max_1 VALUES LESS THAN (400),
            PARTITION p_max_2 VALUES LESS THAN (500),
            PARTITION p_max_3 VALUES LESS THAN (MAXVALUE));
    ```

* 查看表 `test_tbl1` 的结构和定义。

    ```sql
    SHOW CREATE TABLE test_tbl1;
    ```

    返回结果如下：

    ```shell
    +-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | Table     | Create Table                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
    +-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    | test_tbl1 | CREATE TABLE `test_tbl1` (
    `col1` int(11) NOT NULL,
    `col2` int(11) DEFAULT NULL,
    PRIMARY KEY (`col1`)
    ) DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = 1 BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
    partition by range(col1) size ('128MB')
    (partition `p0_1` values less than (30),
    partition `p0_2` values less than (60),
    partition `p0` values less than (100),
    partition `p1` values less than (200),
    partition `p2` values less than (300),
    partition `p_max_1` values less than (400),
    partition `p_max_2` values less than (500),
    partition `p_max_3` values less than (MAXVALUE)) |
    +-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    1 row in set
    ```

## 相关文档

[ALTER TABLE](../../../500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/600.sql-statement-of-mysql-mode/1600.alter-table-of-mysql-mode.md)
